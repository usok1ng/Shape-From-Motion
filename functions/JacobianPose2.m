function J = JacobianPose2(Xi, parameters)
% Induce an equation form Jacobian_derivative.m
X = Xi(1);
Y = Xi(2);
Z = Xi(3);
fx = parameters(1);
fy = parameters(2);
s  = parameters(3);
cx = parameters(4);
cy = parameters(5);
rx = parameters(6);
ry = parameters(7);
rz = parameters(8);
tx = parameters(9);
ty = parameters(10);
tz = parameters(11);

if (0.0 < rx^2+ry^2+rz^2)
    dudrx = (Y*(fx*((rx*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - (rx*rz*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) + (rx^2*ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx^2*ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) - s*((cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1)*((2*rx^3)/(rx^2 + ry^2 + rz^2)^2 - (2*rx)/(rx^2 + ry^2 + rz^2) + (2*rx*rz^2)/(rx^2 + ry^2 + rz^2)^2) + (rx*sin((rx^2 + ry^2 + rz^2)^(1/2))*(rx^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2)) + cx*(sin((rx^2 + ry^2 + rz^2)^(1/2))/(rx^2 + ry^2 + rz^2)^(1/2) - (rx^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (rx^2*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) + (rx*ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2)) + Z*(fx*((rx*ry*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) - (rx*ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (rx^2*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx^2*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) + s*((rx^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - sin((rx^2 + ry^2 + rz^2)^(1/2))/(rx^2 + ry^2 + rz^2)^(1/2) - (rx^2*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) + (rx*ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) - cx*((cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1)*((2*rx^3)/(rx^2 + ry^2 + rz^2)^2 - (2*rx)/(rx^2 + ry^2 + rz^2) + (2*rx*ry^2)/(rx^2 + ry^2 + rz^2)^2) + (rx*sin((rx^2 + ry^2 + rz^2)^(1/2))*(rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2))) + X*(cx*((rx*ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - (rx*ry*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) + (rx^2*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx^2*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) - fx*(((2*rx*ry^2)/(rx^2 + ry^2 + rz^2)^2 + (2*rx*rz^2)/(rx^2 + ry^2 + rz^2)^2)*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + (rx*sin((rx^2 + ry^2 + rz^2)^(1/2))*(ry^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2)) + s*((rx*rz*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) - (rx*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (rx^2*ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx^2*ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2)))/(tz - X*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Y*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Z*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) - ((X*((rx*ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - (rx*ry*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) + (rx^2*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx^2*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) + Y*(sin((rx^2 + ry^2 + rz^2)^(1/2))/(rx^2 + ry^2 + rz^2)^(1/2) - (rx^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (rx^2*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) + (rx*ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) - Z*((cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1)*((2*rx^3)/(rx^2 + ry^2 + rz^2)^2 - (2*rx)/(rx^2 + ry^2 + rz^2) + (2*rx*ry^2)/(rx^2 + ry^2 + rz^2)^2) + (rx*sin((rx^2 + ry^2 + rz^2)^(1/2))*(rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2)))*(cx*tz + fx*tx + s*ty + X*(s*((rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (rx*ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - cx*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + fx*((ry^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) + Y*(cx*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - fx*((rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + s*((rx^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) + Z*(fx*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - s*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + cx*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1))))/(tz - X*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Y*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Z*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1))^2;
else
    dudrx = (Y*cx - Z*s)/(Z + tz) - (Y*(Z*cx + X*fx + Y*s + cx*tz + fx*tx + s*ty))/(Z + tz)^2;
end
if (0.0 < rx^2+ry^2+rz^2)
    dvdrx = (X*(cy*((rx*ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - (rx*ry*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) + (rx^2*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx^2*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) + fy*((rx*rz*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) - (rx*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (rx^2*ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx^2*ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2)) + Y*(cy*(sin((rx^2 + ry^2 + rz^2)^(1/2))/(rx^2 + ry^2 + rz^2)^(1/2) - (rx^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (rx^2*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) + (rx*ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) - fy*((cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1)*((2*rx^3)/(rx^2 + ry^2 + rz^2)^2 - (2*rx)/(rx^2 + ry^2 + rz^2) + (2*rx*rz^2)/(rx^2 + ry^2 + rz^2)^2) + (rx*sin((rx^2 + ry^2 + rz^2)^(1/2))*(rx^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2))) + Z*(fy*((rx^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - sin((rx^2 + ry^2 + rz^2)^(1/2))/(rx^2 + ry^2 + rz^2)^(1/2) - (rx^2*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) + (rx*ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) - cy*((cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1)*((2*rx^3)/(rx^2 + ry^2 + rz^2)^2 - (2*rx)/(rx^2 + ry^2 + rz^2) + (2*rx*ry^2)/(rx^2 + ry^2 + rz^2)^2) + (rx*sin((rx^2 + ry^2 + rz^2)^(1/2))*(rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2))))/(tz - X*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Y*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Z*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) - ((X*((rx*ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - (rx*ry*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) + (rx^2*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx^2*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) + Y*(sin((rx^2 + ry^2 + rz^2)^(1/2))/(rx^2 + ry^2 + rz^2)^(1/2) - (rx^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (rx^2*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) + (rx*ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) - Z*((cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1)*((2*rx^3)/(rx^2 + ry^2 + rz^2)^2 - (2*rx)/(rx^2 + ry^2 + rz^2) + (2*rx*ry^2)/(rx^2 + ry^2 + rz^2)^2) + (rx*sin((rx^2 + ry^2 + rz^2)^(1/2))*(rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2)))*(Y*(cy*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + fy*((rx^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) - Z*(fy*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - cy*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) + cy*tz + fy*ty - X*(cy*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - fy*((rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (rx*ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)))))/(tz - X*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Y*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Z*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1))^2;
else
    dvdrx = (Y*cy - Z*fy)/(Z + tz) - (Y*(Z*cy + Y*fy + cy*tz + fy*ty))/(Z + tz)^2;
end
if (0.0 < rx^2+ry^2+rz^2)
    dudry = (X*(s*((ry*rz*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (rx*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) - (ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (rx*ry^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*ry^2*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) + cx*((ry^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - sin((rx^2 + ry^2 + rz^2)^(1/2))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry^2*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) + (rx*ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) - fx*((cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1)*((2*ry^3)/(rx^2 + ry^2 + rz^2)^2 - (2*ry)/(rx^2 + ry^2 + rz^2) + (2*ry*rz^2)/(rx^2 + ry^2 + rz^2)^2) + (ry*sin((rx^2 + ry^2 + rz^2)^(1/2))*(ry^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2))) + Z*(s*((rx*ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - (rx*ry*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) + (ry^2*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*ry^2*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) + fx*(sin((rx^2 + ry^2 + rz^2)^(1/2))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (ry^2*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) + (rx*ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) - cx*((cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1)*((2*ry^3)/(rx^2 + ry^2 + rz^2)^2 - (2*ry)/(rx^2 + ry^2 + rz^2) + (2*rx^2*ry)/(rx^2 + ry^2 + rz^2)^2) + (ry*sin((rx^2 + ry^2 + rz^2)^(1/2))*(rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2))) + Y*(cx*((rx*ry*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) - (rx*ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (ry^2*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*ry^2*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) - s*(((2*rx^2*ry)/(rx^2 + ry^2 + rz^2)^2 + (2*ry*rz^2)/(rx^2 + ry^2 + rz^2)^2)*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + (ry*sin((rx^2 + ry^2 + rz^2)^(1/2))*(rx^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2)) + fx*((ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - (ry*rz*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (rx*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) + (rx*ry^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*ry^2*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2)))/(tz - X*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Y*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Z*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) - ((Y*((rx*ry*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) - (rx*ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (ry^2*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*ry^2*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) + X*((ry^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - sin((rx^2 + ry^2 + rz^2)^(1/2))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry^2*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) + (rx*ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) - Z*((cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1)*((2*ry^3)/(rx^2 + ry^2 + rz^2)^2 - (2*ry)/(rx^2 + ry^2 + rz^2) + (2*rx^2*ry)/(rx^2 + ry^2 + rz^2)^2) + (ry*sin((rx^2 + ry^2 + rz^2)^(1/2))*(rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2)))*(cx*tz + fx*tx + s*ty + X*(s*((rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (rx*ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - cx*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + fx*((ry^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) + Y*(cx*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - fx*((rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + s*((rx^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) + Z*(fx*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - s*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + cx*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1))))/(tz - X*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Y*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Z*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1))^2;
else
    dudry = (X*(Z*cx + X*fx + Y*s + cx*tz + fx*tx + s*ty))/(Z + tz)^2 - (X*cx - Z*fx)/(Z + tz);
end
if (0.0 < rx^2+ry^2+rz^2)
    dvdry = (X*(fy*((ry*rz*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (rx*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) - (ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (rx*ry^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*ry^2*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) + cy*((ry^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - sin((rx^2 + ry^2 + rz^2)^(1/2))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry^2*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) + (rx*ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2)) - Y*(fy*(((2*rx^2*ry)/(rx^2 + ry^2 + rz^2)^2 + (2*ry*rz^2)/(rx^2 + ry^2 + rz^2)^2)*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + (ry*sin((rx^2 + ry^2 + rz^2)^(1/2))*(rx^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2)) - cy*((rx*ry*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) - (rx*ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (ry^2*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*ry^2*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2)) + Z*(fy*((rx*ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - (rx*ry*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) + (ry^2*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*ry^2*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) - cy*((cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1)*((2*ry^3)/(rx^2 + ry^2 + rz^2)^2 - (2*ry)/(rx^2 + ry^2 + rz^2) + (2*rx^2*ry)/(rx^2 + ry^2 + rz^2)^2) + (ry*sin((rx^2 + ry^2 + rz^2)^(1/2))*(rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2))))/(tz - X*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Y*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Z*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) - ((Y*((rx*ry*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) - (rx*ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (ry^2*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*ry^2*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) + X*((ry^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - sin((rx^2 + ry^2 + rz^2)^(1/2))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry^2*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) + (rx*ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) - Z*((cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1)*((2*ry^3)/(rx^2 + ry^2 + rz^2)^2 - (2*ry)/(rx^2 + ry^2 + rz^2) + (2*rx^2*ry)/(rx^2 + ry^2 + rz^2)^2) + (ry*sin((rx^2 + ry^2 + rz^2)^(1/2))*(rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2)))*(Y*(cy*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + fy*((rx^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) - Z*(fy*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - cy*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) + cy*tz + fy*ty - X*(cy*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - fy*((rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (rx*ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)))))/(tz - X*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Y*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Z*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1))^2;
else
    dvdry = (X*(Z*cy + Y*fy + cy*tz + fy*ty))/(Z + tz)^2 - (X*cy)/(Z + tz);
end
if (0.0 < rx^2+ry^2+rz^2)
    dudrz = (X*(cx*((ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - (ry*rz*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (rx*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) + (rx*rz^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*rz^2*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) + s*(sin((rx^2 + ry^2 + rz^2)^(1/2))/(rx^2 + ry^2 + rz^2)^(1/2) - (rz^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (rz^2*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) + (rx*ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) - fx*((cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1)*((2*rz^3)/(rx^2 + ry^2 + rz^2)^2 - (2*rz)/(rx^2 + ry^2 + rz^2) + (2*ry^2*rz)/(rx^2 + ry^2 + rz^2)^2) + (rz*sin((rx^2 + ry^2 + rz^2)^(1/2))*(ry^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2))) + Y*(cx*((rx*rz*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) - (rx*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (ry*rz^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*ry*rz^2*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) - s*((cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1)*((2*rz^3)/(rx^2 + ry^2 + rz^2)^2 - (2*rz)/(rx^2 + ry^2 + rz^2) + (2*rx^2*rz)/(rx^2 + ry^2 + rz^2)^2) + (rz*sin((rx^2 + ry^2 + rz^2)^(1/2))*(rx^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2)) + fx*((rz^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - sin((rx^2 + ry^2 + rz^2)^(1/2))/(rx^2 + ry^2 + rz^2)^(1/2) - (rz^2*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) + (rx*ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2)) + Z*(fx*((ry*rz*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (rx*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) - (ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (rx*rz^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*rz^2*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) - cx*(((2*rx^2*rz)/(rx^2 + ry^2 + rz^2)^2 + (2*ry^2*rz)/(rx^2 + ry^2 + rz^2)^2)*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + (rz*sin((rx^2 + ry^2 + rz^2)^(1/2))*(rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2)) + s*((rx*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - (rx*rz*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) + (ry*rz^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*ry*rz^2*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2)))/(tz - X*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Y*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Z*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) - ((X*((ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - (ry*rz*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (rx*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) + (rx*rz^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*rz^2*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) - Z*(((2*rx^2*rz)/(rx^2 + ry^2 + rz^2)^2 + (2*ry^2*rz)/(rx^2 + ry^2 + rz^2)^2)*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + (rz*sin((rx^2 + ry^2 + rz^2)^(1/2))*(rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2)) + Y*((rx*rz*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) - (rx*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (ry*rz^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*ry*rz^2*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2))*(cx*tz + fx*tx + s*ty + X*(s*((rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (rx*ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - cx*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + fx*((ry^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) + Y*(cx*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - fx*((rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + s*((rx^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) + Z*(fx*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - s*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + cx*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1))))/(tz - X*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Y*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Z*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1))^2;
else
    dudrz = -(Y*fx - X*s)/(Z + tz);
end
if (0.0 < rx^2+ry^2+rz^2)
    dvdrz = (X*(cy*((ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - (ry*rz*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (rx*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) + (rx*rz^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*rz^2*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) + fy*(sin((rx^2 + ry^2 + rz^2)^(1/2))/(rx^2 + ry^2 + rz^2)^(1/2) - (rz^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (rz^2*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) + (rx*ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2)) - Z*(cy*(((2*rx^2*rz)/(rx^2 + ry^2 + rz^2)^2 + (2*ry^2*rz)/(rx^2 + ry^2 + rz^2)^2)*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + (rz*sin((rx^2 + ry^2 + rz^2)^(1/2))*(rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2)) - fy*((rx*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - (rx*rz*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) + (ry*rz^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*ry*rz^2*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2)) + Y*(cy*((rx*rz*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) - (rx*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (ry*rz^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*ry*rz^2*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) - fy*((cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1)*((2*rz^3)/(rx^2 + ry^2 + rz^2)^2 - (2*rz)/(rx^2 + ry^2 + rz^2) + (2*rx^2*rz)/(rx^2 + ry^2 + rz^2)^2) + (rz*sin((rx^2 + ry^2 + rz^2)^(1/2))*(rx^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2))))/(tz - X*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Y*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Z*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) - ((X*((ry*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) - (ry*rz*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (rx*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) + (rx*rz^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*rx*rz^2*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2) - Z*(((2*rx^2*rz)/(rx^2 + ry^2 + rz^2)^2 + (2*ry^2*rz)/(rx^2 + ry^2 + rz^2)^2)*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + (rz*sin((rx^2 + ry^2 + rz^2)^(1/2))*(rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2)))/(rx^2 + ry^2 + rz^2)^(1/2)) + Y*((rx*rz*cos((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2) - (ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2) - (rx*rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (ry*rz^2*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(3/2) + (2*ry*rz^2*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)^2))*(Y*(cy*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + fy*((rx^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) - Z*(fy*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - cy*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) + cy*tz + fy*ty - X*(cy*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - fy*((rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (rx*ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)))))/(tz - X*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Y*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Z*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1))^2;
else
    dvdrz = (X*fy)/(Z + tz);
end
if (0.0 < rx^2+ry^2+rz^2)
    dudtx = fx/(tz - X*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Y*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Z*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1));
else
    dudtx = fx/(Z+tz);
end
dvdtx = 0.0;
if (0.0 < rx^2+ry^2+rz^2)
    dudty = s/(tz - X*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Y*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Z*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1));
else
    dudty = s/(Z + tz);
end
if (0.0 < rx^2+ry^2+rz^2)
    dvdty = fy/(tz - X*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Y*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Z*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1));
else
    dvdty = fy/(Z+tz);
end
if (0.0 < rx^2+ry^2+rz^2)
    dudtz = cx/(tz - X*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Y*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Z*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) - (cx*tz + fx*tx + s*ty + X*(s*((rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (rx*ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - cx*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + fx*((ry^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) + Y*(cx*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - fx*((rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + s*((rx^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) + Z*(fx*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - s*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + cx*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)))/(tz - X*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Y*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Z*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1))^2;
else
    dudtz = cx/(Z + tz) - (Z*cx + X*fx + Y*s + cx*tz + fx*tx + s*ty)/(Z + tz)^2;
end
if (0.0 < rx^2+ry^2+rz^2)
    dvdtz = cy/(tz - X*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Y*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Z*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) - (Y*(cy*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + fy*((rx^2/(rx^2 + ry^2 + rz^2) + rz^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) - Z*(fy*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - cy*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1)) + cy*tz + fy*ty - X*(cy*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) - fy*((rz*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (rx*ry*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2))))/(tz - X*((ry*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) + (rx*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Y*((rx*sin((rx^2 + ry^2 + rz^2)^(1/2)))/(rx^2 + ry^2 + rz^2)^(1/2) - (ry*rz*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1))/(rx^2 + ry^2 + rz^2)) + Z*((rx^2/(rx^2 + ry^2 + rz^2) + ry^2/(rx^2 + ry^2 + rz^2))*(cos((rx^2 + ry^2 + rz^2)^(1/2)) - 1) + 1))^2;
else
    dvdtz = cy/(Z + tz) - (Z*cy + Y*fy + cy*tz + fy*ty)/(Z + tz)^2;
end
J = [dudrx dudry dudrz dudtx dudty dudtz;
     dvdrx dvdry dvdrz dvdtx dvdty dvdtz];